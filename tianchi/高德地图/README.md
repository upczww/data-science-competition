# 思路说明

[阿里巴巴高德地图AMAP-TECH算法大赛 - 基于车载视频图像的动态路况分析](https://tianchi.aliyun.com/competition/entrance/531809/introduction?spm=5176.12281957.1004.3.38b02448Cfwq1r)


团队:**limzero** 

**初赛a榜:Top5吧(记不清了)，b榜:Rank 4 ,复赛a榜:Rank2 b榜:Rank 7**

## 初赛

该比赛初赛/复赛虽然相差甚远，但初赛也还是有点意思,主要因为时间特征是一个泄露,发现了这一点稍加利用就可以大幅上分。还是分为两个思路来讲：

1.  **CNN分类**,线下验证很不可靠,所以略过,通过调整训练策略,以及对输入图像进行一些没有道理的预处理(比如我就是四张图拼起来的)xception可以分类到线上**71+.**

2.  **检测+树模型**:使用coco上预训练的81类的检测器(yolov5,efficient都用了,效果大差不差)将环境中的车辆,行人等目标进行定位,然后提取其统计特征。

   - 车辆相对原图的大小(特别是离图片底部的距离最近的那些目标的相对大小)
   - 车辆的位置(距离图片中心,两侧，底部的距离等)
   - 对所有目标框中心点进行k-means聚类，得到新特征
   - 划分图片的Roi区域,我划分的大概就是一个三角形区域, 然后单独对Roi区域的特征进行统计
   - 对以上各个特征的mean,std,max,min进行统计
   - **序列特征**:以上的特征都是针对的单图,要得到序列特征。可以将相邻帧的特征进行一个统计,比如相邻帧特征的方差就是一个可以刻画帧变化的特征(但也应当注意通过帧差时间进行归一化)
   - 时间特征:这个算top 3的强特了吧(虽然复赛被安排了)
     检测+加树模型最终线上可以达到**78+** 的分数，初赛最终排名:**Rank 4**.(其实感觉就是不断的在强行过拟合初赛a榜) 

### 复赛

怎么讲,复赛加了一个类别,但这个类别实在是太容易分了，无论是用检测还是直接分类都能很好的被区分,这就导致一个问题,特别是分类模型,很容易过拟合线下的数据。这也是导致线上线下gap很大的一个原因。复赛我们队应该是第一个突破70的队伍,而且占据榜一很久,不过胜利来得太早了就容易飘,放松了一段时间,导致b榜被翻盘,甚至被挤出前五。。。。
复赛我们通过分类一度处于榜一位置,以至于比较松懈，加上最后b榜时间太久,而我们一直使用单模型分类有自己的局限性.所以最终复赛只取得了Rank7的成绩

#### 先说线上a榜:71,b榜:70的方案

这里感谢我的大佬队友,用了一个碉堡了的CNN模型加上一些很骚的训练策略和增强手段和一些即插即用的注意力模块,单图送进去强行分类,出来单模就是70+，

虽然很猛,但这也限制了我们的上限。

#### 沿袭初赛的检测+树模型方案

**两个检测器**(都是基于**mmdetection**)

- 第一个检测器cascade_Res50干的事和初赛一样:上面所讲到的那些特征,我给整了200+特征吧(事后感觉大部分都是毒特征),
- 第二个检测器Res2Net50对第四类单独进行区分,将置信度当做特征.（其实仅仅通过卡一个置信度阈值的方式就能实现对第四类的精准识别）
- 卷积特征: 利用队友的70+CNN的模型提取图片特征。具体操作是这样:对一个序列的每一帧图像送给训练好的CNN模型,取最后全连接层前的2048纬特征,将该序列的每一帧2048特征进行融合(尝试了平均,拼接),将这2048特征和200+的检测特征一起送给lightgbm进行分类。这一通操作猛如虎,线上一看695，狂掉一个点。我想应该还是分类模型过拟合太严重,出来的特征把树模型一波带走了,加上检测特征没那么的强,所以被边缘化了。这个思路尝试了两次不成功,加上队友的CNN太猛,我们全队都对CNN蜜汁自信,一直死磕CNN，最终半个月还是那70分，毫无长进，这种状态一直持续到b榜,被人挤出了前五。a榜**Rank 2****,b榜**Rank 7**，心态炸裂！

### 总结

总体而言,数据量太小了,特别是线上测试数据。其实很难完全反应出模型的真实实力,摸奖的成分较大,取得了好成绩不代表多么厉害，大概率还是模型到位了。

这比赛学得很多,比如我可能前后写了好几千行代码吧,但都是无用代码,感觉还是要多思考，少写一些没有用的代码,不数学的那种trick就不要胡乱尝试,没有意义。

